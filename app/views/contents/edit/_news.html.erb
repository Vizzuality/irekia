<% content_for :facebook_meta do -%>
  <meta property="og:title" content="Irekia - <%= @content.title %>" />
  <meta property="og:description" content="<%= @content.body.strip.truncate(128) %>" />
  <meta property="og:image" content="<%= image_url @content.news_data.image.content_url if @content.news_data.image.present? %>" />
<% end -%>

<div class="article activity editable with_footer">
  <div class="inner">
    <div class="left">

      <div class="context">
        <h3><%= t(@content.content_type) %></h3>
        <span class="middot">&middot;</span>
        <ul class="editable tags">
          <% @content.areas_contents.each do |ac| %>
            <li data-id="<%= ac.area_id %>"<%=" class='editable'" if @editable %>>
            <%= link_to ac.area.name, area_path(ac.area) %>

            <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => :remove} do |form| %>
              <%= form.fields_for :areas_contents, ac do |areas_contents| %>
                <%= areas_contents.hidden_field :_destroy, :value => true %>
              <% end -%>
              <%= form.submit 'x', :class => 'remove' %>
            <% end -%>

            </li>
          <% end %>

          <% if @editable %>
            <li class="add add_area"><%= link_to "+", "#", :class => :content %></li>
          <% end %>
        </ul>

        <div class="areas_editable_selector">
          <div class="popover">
            <div class="scroll-pane">
              <ul>
                <% @areas.each do |area| %>
                  <li data-id="<%= area.id %>" class="<%= 'selected' if @content.areas.map(&:id).include?(area.id) %><%= ' last' if @areas.last == area %>">
                  <%= form_for @content, :remote => true, :html => { :'data-type' => 'html' } do |form| %>
                    <%= hidden_field_tag :partial, 'tagged_area' %>
                    <%= form.fields_for :areas_contents, @content.areas_contents.build do |areas_contents| %>
                      <%= areas_contents.hidden_field :area_id, :value => area.id %>
                    <% end -%>
                    <%= form.submit area.name %>
                  <% end -%>
                  </li>
                  <% end if @areas %>
                </ul>
              </div>
            </div>
          </div>

        </div>

        <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'editable text'} do |form| %>
          <%= content_tag :h1, @content.title, :class => :content %>
          <%= form.fields_for :news_data do |news_data| %>
            <div class="input_field textarea">
              <%= news_data.text_area :title, :value => @content.title %>
            <% end -%>
          </div>
          <%= button "Publicar", :class => "submit white_button" %>
        <% end -%>

        <% unless @content.subtitle.blank? %>
          <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'editable text'} do |form| %>
            <%= content_tag :p, (content_tag :strong, @content.subtitle), :class => "subtitle content" if @content.subtitle %>

            <%= form.fields_for :news_data do |news_data| %>
              <div class="input_field textarea">
                <%= news_data.text_area :subtitle, :value => @content.subtitle %>
              </div>
            <% end -%>
            <%= button "Publicar", :class => "submit white_button" %>
          <% end -%>
        <% end %>

        <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'editable date'} do |form| %>
          <div class="meta">
            <span class="date content"><%= l @content.published_at.to_date, :format => :long %></span>
            <%= form.date_select :published_at, :value => @content.published_at.to_date, :format => :long  %>
            <%= button "Guardar", :class => "submit white_button" %>
          </div>
        <% end -%>

        <!-- IMAGE -->
        <div class="image_editor">

          <div class="image_container">
            <%= image_tag @content.news_data.image.content_url if @content.news_data.image.present? %>

            <!-- remove -->
            <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'remove'} do |form| %>
              <%= form.fields_for :news_data do |news_data| %>
                <%= news_data.fields_for :image do |image| %>
                  <%= image.hidden_field :_destroy, :value => true %>
                  <%= image.submit '', :class => :remove %>
                <% end -%>
              <% end -%>
            <% end -%>
            <!-- remove -->
          </div>

          <div class="add_image"<%= " style='display:none'" if @content.news_data.image.present? %>>
            <a href="#">AÃ±adir foto</a>
          </div>

          <div class="input_field uploader placeholder" style="display:none">
            <input type="text" />
            <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'editable image'} do |form| %>
              <span class="holder"><span>Introduce la URL de la foto o</span> <span class="upload" id="upload_new_image" data-url="<%= news_index_path %>">Sube una nueva</span></span>
              <%= form.fields_for :news_data do |news_data| %>
                <%= news_data.fields_for :image, (@content.news_data.image || @content.news_data.build_image) do |image|%>
                  <%= image.hidden_field :remote_image_url %>
                  <%= image.hidden_field :image, :class => :image_cache_name %>
                  <%#= image.text_area :description %>
                <% end -%>
              <% end -%>
            <% end -%>
            <span class="percentage">0%</span>
            <span class="loading">Cargando imagen...</span>
            <div class="progress"></div>
          </div>


        </div>
        <!-- IMAGE -->

        <%= form_for @content, :remote => true, :html => {:'data-type' => 'html', :class => 'editable text'} do |form| %>
          <%= content_tag :div, (sanitize @content.body.try(:strip), :tags => %w(p strong), :attributes => nil), :class => :content  %>

          <%= form.fields_for :news_data do |news_data| %>
            <div class="input_field textarea">
              <%= news_data.text_area :body, :value => @content.body %>
            </div>
          <% end -%>

          <%= button "Publicar", :class => "submit white_button" %>
        <% end -%>

        <%= render "participations/comments" %>

      </div>
      <div class="right">
        <div class="content left-border">

          <%= sharing_partial(news_url(@content), @content.title) %>
          <%= render "shared/sidebar/tags" %>
          <%= render "shared/sidebar/politicians" %>
          <%= render "shared/sidebar/location" %>
          <%= render "shared/sidebar/related_content" %>

        </div>
      </div>
    </div>

    <footer>
    <div class="separator"></div>
    <div class="inner">

      <div class="left">
        <%= link_to t(".back"), "/in_development", :class => :left_arrow %>
      </div>

    </div>
    </footer>
    <div class="t"></div><div class="f"></div>
  </div>


  <%= render "shared/event_edit" %>
